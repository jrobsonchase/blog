variables:
  REGISTRY: registry.gitlab.com
  REPOSITORY: jrobsonchase/blog
  IMAGE: zola
  VERSION: v0.10.1

stages:
  - build
  - pages

image: "${REGISTRY}/${REPOSITORY}/${IMAGE}:${VERSION}"

build stable:
  stage: build
  script:
    - zola build
  artifacts:
    paths:
      - public

build latest:
  extends: build stable
  variables:
    EXTRA_PATH: latest
  image: "${REGISTRY}/${REPOSITORY}/${IMAGE}:latest"
  allow_failure: true
  script:
    - zola build --drafts -u https://josh.robsonchase.com/${EXTRA_PATH} -o public/${EXTRA_PATH}

build next:
  extends: build latest
  image: "${REGISTRY}/${REPOSITORY}/${IMAGE}:next"
  variables:
    EXTRA_PATH: next

pages:
  script: "true"
  stage: pages
  artifacts:
    paths:
      - public
  only:
    - master

